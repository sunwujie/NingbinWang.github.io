---
layout:     post
title:      "漫谈android系统4"
subtitle:   " bring up panel "
date:       2016-06-19 12:08:00
author:     "alex"
header-img: "img/post/post-android-4.jpg"
catalog: true
tags:
    - android
---
## LCD

LCD 是指字面意思是液晶显示屏(Liquid Crystal Display), 而RAM: 随机存取存储器(Random-Access Memory）。控制IC是LCD的大脑。所谓的LCD RAM自然是指此大脑是否包含RAM.

LCD的种类分类标准比多，按驱动方式可以分为：被动矩阵式、主动矩阵式两种:

* 被动矩阵式：被动矩阵式LCD又可分为TN-LCD(TwistedNematic-LCD，扭曲向列LCD)、STN—LCD(SuperTN-LCD，超扭曲向列LCD)和DSTN-LCD(Doublelayer STN-LCD，双层超扭曲向列LCD).
* 主动矩阵式:目前应用比较广泛的主动矩阵式LCD，也称TFT-LCD。TFT-LCD 即是Thin-FilmTransistor Liquid-Crystal Display的缩写(薄膜电晶体液晶显示器)

TFT-LCD 结构侧视图 

![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi4.png)

其具体的物理定义请参照[Android LCD(一)：LCD基本原理篇 ](http://blog.csdn.net/xubin341719/article/details/9125583)

LCD传输的信号有很多：
* TTL（主要用于小屏）
* LVDS，即Low Voltage Differential Signaling，是一种低压差分信号技术接口。克服以TTL电平方式传输宽带高码率数据时功耗大、EMI电磁干扰大等缺点而研制的一种数字视频信号传输方式
* EDP
* MIPI（我主要对此有过研究，因此在这个接口上会详细讲述）

PS：基本上作为手机制造商来讲，会使用mipi作为接口，据我现在工作的华硕公司来讲，基本上使用的都是TM、BOE的panel。

想要了解其他的借口信号可以参考[Android LCD(二)：LCD常用接口原理篇](http://blog.csdn.net/xubin341719/article/details/9125799)

## MIPI
MIPI (Mobile Industry Processor Interface) 是2003年由ARM, Nokia, ST ,TI等公司成立的一个联盟，目的是把手机内部的接口如摄像头、显示屏接口、射频/基带接口等标准化，从而减少手机设计的复杂程度和增加设计灵活性。 MIPI联盟下面有不同的WorkGroup，分别定义了一系列的手机内部接口标准，比如摄像头接口CSI、显示接口DSI、射频接口DigRF、麦克风 /喇叭接口SLIMbus等。统一接口标准的好处是手机厂商根据需要可以从市面上灵活选择不同的芯片和模组，更改设计和功能时更加快捷方便。

下图是以mipi为例的手机内部框架图：

![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi1.jpg)

CSI/DSI分别是指其承载的是针对Camera或Display应用，都有复杂的协议结构。以DSI为例，其协议层结构如下：

![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi2.JPG)

DSI (Display Serial Interface)定义了一个位于处理器和显示模组之间的高速串行接口

DSI分四层，对应D-PHY、DSI、DCS规范

* PHY 定义了传输媒介，输入/输出电路和和时钟和信号机制。
* Lane Management层：发送和收集数据流到每条lane
* Low Level Protocol层：定义了如何组帧和解析以及错误检测等
* Application层：描述高层编码和解析数据流

屏幕传输中又对应的2种不同的传输模式：

* Command mode:对应传输的是mpu接口
* Video mode:对应的是RGB接口，这种传输数据方式只能通过hs mode进行传输

##### mipi传输模式

* LP(low-power低功耗)用于控制，采用单端信号 
* HS(high-speed)用于高速传输，采用低压差分信号 （抑制共模噪声）

对于LP与HS各个状态所代表的状态表

![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi3.png)

##### DSI时钟信号

DSI 时钟 Lanes 有三种模式 Low power mode（LPM），Ultra Low power mode（ULPM超低俗），High Speed Clock mode（HSCM） 
可以参照上表做分析：

![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi5.png)

这部分内容主要是看时钟信号，后面会具体整理后上传

小结：传输图像等数据是通过HSmode传输保证了数据的快速传递，而下相关的command去控制panel的寄存器就需要使用LPmode传输，可以保证数据的正确性。

## bring up panel

#####  拿到panel板子，首先问厂商要该板子的code，包括initial code，reset sequence ，porch setting。

![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi6.png)

图中相关信息
* step 1-7  电压配置，LP11 拉高。
* step 8-12  reset sequence （重要）
* step 13-18  on command 点亮屏幕


![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi7.jpg)

这个是上电的sequence，包括前面的电压配置（不同电压之间的延时），reset sequence ， MIPI data&clock  ， command  ，最后是数据传输


![](https://raw.githubusercontent.com/NingbinWang/NingbinWang.github.io/master/img/post/mipi/mipi8.jpg)

Porch setting 数据正如前面所说，是DSI video mode的Timing

##### 根据厂商panel 的 IC 和 code 计算timging ，填写xml文档。
