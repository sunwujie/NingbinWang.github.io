---
layout:     post
title:      " bat档 "
subtitle:   "  批处理命令 "
date:       2016-06-01 12:08:00
author:     "alex"
header-img: "img/post/windows-1.jpg"
catalog: true
tags:
    - windows
---

## 什么是批处理

批处理文件（batch file）包含一系列 DOS命令，通常用于自动执行重复性任务。用户只需双击批处理文件便可执行任务，而无需重复输入相同指令。

>批处理(Batch)，也称为批处理脚本。顾名思义，批处理就是对某对象进行批量的处理。批处理文件的扩展名为bat。

## 批处理命令简介

#### echo

打开回显或关闭请求回显功能，或显示消息。如果没有任何参数，echo 命令将显示当前回显设置。

>echo [{on|off}] [message]
>Sample：@echo off / echo hello world

在实际应用中我们会把这条命令和重定向符号（也称为管道符号，一般用> >> ^）结合来实现输入一些命令到特定的文件中。

#### rem

注释命令，类似于在C语言中的/*--------*/，它并不会被执行，只是起一个注释的作用，便于别人阅读和你自己日后修改。

>Rem Message
>Sample：@Rem Here is the description.

#### pause

暂停命令。运行 Pause 命令时，将显示下面的消息：Press any key to continue. . .(或：请按任意键继续. . .)

>Sample：
>@echo off
>:begin
>copy G:*.* d：/back
>echo 请插入另一张光盘...
>pause
>goto begin

在这个例子中，驱动器 G 中磁盘上的所有文件均复制到d:/back中。显示的注释提示您将另一张光盘盘放入驱动器 G 时，pause 命令会使程序挂起，以便您更换光盘，然后按任意键继续处理。

#### call

从一个批处理程序调用另一个批处理程序，并且不终止父批处理程序。call 命令接受用作调用目标的标签。如果在脚本或批处理文件外使用 Call，它将不会在命令行起作用。

>call [[Drive:][Path] FileName ] [:label [arguments]]
>参数
>[Drive:}[Path] FileName

指定要调用的批处理程序的位置和名称。

#### start

调用外部程序，所有的DOS命令和命令行程序都可以由start命令来调用。 如：start calc.exe 即可打开Windows的计算器。

#### goto

跳转命令。程序指针跳转到指定的标签，从标签后的第一条命令开始继续执行批处理程序。

>goto label （label是参数，指定所要转向的批处理程序中的行。）

#### set

显示、设置或删除变量。

显示变量：set 或 set s 前者显示批处理当前已定义的所有变量及其值，后者显示所有以s开头的变量及值。

设置变量：set aa=abcd 此句命令便可向变量aa赋值abcd。

如果变量aa已被定义，则aa的值被修改为abcd；若aa尚未定义，则此句命令即可定义新的变量aa，同时为变量aa赋予初始值abcd。

删除变量：set aa= 此句命令即可删除变量aa。若变量aa已被定义，则删除变量aa；若aa尚未定义，则此句命令为实质意义。

需要说明的是，批处理中的变量是不区分类型的，不需要像C语言中的变量那样还要区分int、float、char等。比如执行set aa=345后，变量aa的值既可以被视为数字345，也可以被视为字符串345。

set命令具有扩展功能，如用作交互输入、字符串处理、数值计算等，属于高级命令范畴。

#### echo 和 @回显控制命令

```
@                   #关闭单行回显
echo off             #从下一行开始关闭回显
@echo off            #从本行开始关闭回显。一般批处理第一行都是这个
echo on              #从下一行开始打开回显
echo                 #显示当前是 echo off 状态还是 echo on 状态
echo.                #输出一个"回车换行"，一般就是指空白行
echo hello world     #输出hello world
```

"关闭回显"是指运行批处理文件时，不显示文件里的每条命令，只显示运行结果批处理开始和结束时，系统都会自动打开

#### errorlevel程序返回码

echo %errorlevel%每个命令运行结束，可以用这个命令行格式查看返回码用于判断刚才的命令是否执行成功默认值为0，一般命令执行出错会设 errorlevel 为1

#### dir显示目录中的文件和子目录列表

```
dir                 #显示当前目录中的文件和子目录
dir /a              #显示当前目录中的文件和子目录，包括隐藏文件和系统文件
dir c: /a:d         #显示 C 盘当前目录中的目录
dir c:/ /a:-d       #显示 C 盘根目录中的文件dir d:/mp3 /b/p     #逐屏显示 d:/mp3 目录里的文件，只显示文件名，不显示时间和大小
dir *.exe /s        #显示当前目录和子目录里所有的.exe文件其中 * 是通配符，代表所有的文件名，还一个通配符 ? 代表一个
                    #任意字母或汉字如 c*.* 代表以 c 开头的所有文件?.exe 代表所有文件名是一个字母的.exe文件如果指定的目录或文件
                    #不存在，将返回 errorlevel 为1;

# 每个文件夹的 dir 输出都会有2个子目录 . 和 ... 代表当前目录.. 代表当前目录的上级目录
dir .               #显示当前目录中的文件和子目录
dir ..              #显示当前目录的上级目录中的文件和子目录
```

#### cd

cd更改当前目录

```
cd mp3              #进入当前目录中的mp3 目录
cd ..               #进入当前目录中的上级目录
cd/                 #进入根目录
cd                  #显示当前目录
cd /d d:/mp3        #可以同时更改盘符和目录
cd "Documents and Settings"/All users文件名带空格，路径前需要加上引号！！如果更改到的目录不存在，则出错返
```

#### md创建目录

```
md abc              #在当前目录里建立子目录 abc
md d:/a/b/c         #如果 d:/a 不存在，将会自动创建
```

#### rd删除目录

```
rd abc              #删除当前目录里的 abc 子目录，要求为空目录
rd /s/q d:/temp     #删除 d:/temp 文件夹及其子文件夹和文件，不需要按 Y 确认
```

#### del删除文件

```
del d:/test.txt     #删除指定文件，不能是隐藏、系统、只读文件
del *.*删除当前目录里的所有文件，不包括隐藏、系统、只读文件，要求按 Y 确认
del /q/a/f d:/temp/*.*删除 d:/temp 文件夹里面的所有文件，包括隐藏、只读、系统文件，不包括子目录
del /q/a/f/s d:/temp/*.*删除 d:/temp 及子文件夹里面的所有文件，包括隐藏、只读、系统文件，不包括子目录
```


#### ren文件重命名

```
ren 1.txt 2.bak     #把 1.txt 更名为 2.bak
ren *.txt *.ini     #把当前目录里所有.txt文件改成.ini文件
ren d:/temp tmp     #支持对文件夹的重命名
```

#### cls清屏

#### type显示文件内容

```
type c:/boot.ini    #显示指定文件的内容，程序文件一般会显示乱码
type *.txt          #显示当前目录里所有.txt文件的内容
```

#### copy拷贝文件

```
copy c:/test.txt d:/复制 c:/test.txt 文件到 d:/
copy c:/test.txt d:/test.bak复制 c:/test.txt 文件到 d:/ ，并重命名为 test.bak
copy c:/*.*复制 c:/ 所有文件到当前目录，不包括隐藏文件和系统文件不指定目标路径，则默认目标路径为当前目录
copy con test.txt从屏幕上等待输入，按 Ctrl+Z 结束输入，输入内容存为test.txt文件con代表屏幕，prn代表打印机，nul代表空设备
copy 1.txt + 2.txt 3.txt合并 1.txt 和 2.txt 的内容，保存为 3.txt 文件如果不指定 3.txt ，则保存到 1.txt
copy test.txt +复制文件到自己，实际上是修改了文件日期
```


#### date 和 time日期和时间

```
date          #显示当前日期，并提示输入新日期，按"回车"略过输入
date/t        #只显示当前日期，不提示输入新日期
time          #显示当前时间，并提示输入新时间，按"回车"略过输入
time/t        #只显示当前时间，不提示输入新时间
```

#### find (外部命令)查找命令

```
find "abc" c:/test.txt在 c:/test.txt 文件里查找含 abc 字符串的行如果找不到，将设 errorlevel 返回码为1
find /i "abc" c:/test.txt查找含 abc 的行，忽略大小写
find /c "abc" c:/test.txt显示含 abc 的行的行数
```

#### more (外部命令)逐屏显示

```
more c:/test.txt    #逐屏显示 c:/test.txt 的文件内容
```

#### tree显示目录结构

```
tree d:/            #显示D盘的文件目录结构
```

####  &顺序执行多条命令，而不管命令是否执行成功

c: & cd/ & dir /w相当于把下面3行命令写到1行去了c:cd/dir /w

#### &&顺序执行多条命令，当碰到执行出错的命令后将不执行后面的命令

f: && cd/ && dir >c:/test.txt注意如果f盘不存在，那么后面2条命令将不会执行

find "ok" c:/test.txt && echo 成功如果找到了"ok"字样，就显示"成功"，找不到就不显示

#### ||顺序执行多条命令，当碰到执行正确的命令后将不执行后面的命令

find "ok" c:/test.txt || echo 不成功如果找不到"ok"字样，就显示"不成功"，找到了就不显示

#### |管道命令

前一个命令的执行结果输出到后一个命令

dir *.* /s/a | find /c ".exe"管道命令表示先执行 dir 命令，对其输出的结果执行后面的 find 命令该命令行结果：

输出当前文件夹及所有子文件夹里的.exe文件的个数

type c:/test.txt|more这个和 more c:/test.txt 的效果是一样的

#### 输出重定向命令

清除文件中原有的内容后再写入

追加内容到文件末尾，而不会清除原有的内容主要将本来显示在屏幕上的内容输出到指定文件中指定文件如果不存在，则自动生成该文件

```
echo hello world>c:/test.txt   生成c:/test.txt文件，内容为hello world这个格式在批处理文件里用得很多，可以生成.reg .bat .vbs 等临时文件
type c:/test.txt >prn          屏幕上不显示文件内容，转向输出到打印机
echo hello world>con           在屏幕上显示hello world，实际上所有输出都是默认 >con 的
copy c:/test.txt f: >nul       拷贝文件，并且不显示"文件复制成功"的提示信息，但如果f盘不存在，还是会显示出错信息
copy c:/test.txt f: >nul 2>nul 不显示"文件复制成功"的提示信息，并且f盘不存在的话，也不显示错误提示信息
echo ^^W ^> ^W>c:/test.txt     生成的文件内容为 ^W > W^ 和 > 是控制命令，要把它们输出到文件，必须在前面加个 ^符号
```

#### 从文件中获得输入信息，而不是从屏幕上

一般用于 date time label 等需要等待输入的命令，这样就可以不等待输入直接修改当前日期

```
@echo off
echo 2005-05-01>temp.txt
date <temp.txt
del temp.txt
```

#### %0 %1 %2 %3 %4 %5 %6 %7 %8 %9 %*命令行传递给批处理的参数

```
%0 批处理文件本身
%1 第一个参数
%9 第九个参数
%* 从第一个参数开始的所有参数
在C盘根目录新建test.bat，内容如下：

@echo off
echo %0
echo %1
echo %2
echo %*
运行cmd，输入 c:/test.bat "/a" /b /c /d,可以看出每个参数的含意 修改test.bat内容如下

@echo off
echo %1
echo %~1
echo %0
echo %~f0
echo %~d0
echo %~p0
echo %~n0
echo %~x0
echo %~s0
echo %~a0
echo %~t0
echo %~z0
再运行cmd，输入 c:/test.bat "/a" /b /c /d可以参照 call/? 或 for/? 看出每个参数的含意，注意这里可以对文件进行日期比较和大小比较：
echo load "%%1" "%%2">c:/test.txt
```

生成的文件内容为 load "%1" "%2"批处理文件里，用这个格式把命令行参数输出到文件

```
%CD%                  #代表当前目录的字符串
%DATE%                #当前日期
%TIME%                #当前时间
%RANDOM%              #随机整数，介于0~32767
%ERRORLEVEL%          #当前ERRORLEVEL 值
%CMDEXTVERSION%       #当前命令处理器扩展名版本号
%CMDCMDLINE%          #调用命令处理器的原始命令行可以用echo命令查看每个变量值，如 echo %time%
```

注意 %time%精确到毫秒，在批处理需要延时处理时可以用到



#### pushd 和 popd切换当前目录

```
@echo off
c: & cd/ & md mp3       #在 C:/ 建立 mp3 文件夹
md d:/mp4               #在 D:/ 建立 mp4 文件夹
cd /d d:/mp4            #更改当前目录为 d:/mp4
pushd c:/mp3            #保存当前目录，并切换当前目录为 c:/mp3
popd                    #恢复当前目录为刚才保存的 d:/mp4一般用处不大，在当前目录名不确定时，会有点帮助
subst (外部命令)映射磁盘。
subst z: //server/d     #这样输入z:就可以访问//server/d了
subst z: /d             #取消该映射
subst                   #显示目前所有的映
xcopy (外部命令)文件拷贝
xcopy d:/mp3 e:/mp3 /s/e/i/y
```

复制 d:/mp3 文件夹、所有子文件夹和文件到 e:/，覆盖已有文件，加 /i 表示如果 e:/ 没有 mp3 文件夹就自动新建一个，否则会有询问


#### SC (外部命令)服务控制命令

```
sc create aaa displayname= bbb start= auto binpath= "C:/WINDOWS/System32/alg.exe"创建服务，服务名称aaa，显示名称bbb，启动类型:自动可执行文件的路径"C:/WINDOWS/System32/alg.exe"
sc description aaa "ccc"更改aaa的描述为ccc
sc config aaa start= disabled binpath= "C:/WINDOWS/System32/svchost.exe -k netsvcs"更改aaa的启动类型:已禁用更改aaa的可执行文件的路径"C:/WINDOWS/System32/svchost.exe -k netsvcs"
sc config aaa start= demand displayname= ddd更改aaa的启动类型:手动更改aaa的显示名称ddd
sc start aaa启动aaa服务
sc stop aaa停止aaa服务
sc delete aaa删除aaa服务
```
